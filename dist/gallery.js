define("mixins/data-options",[],function(){return{parseOptions:function(){var e=this,t=this.$el.data()||{};return $.each(t,function(n,r){t.hasOwnProperty(n)&&(e.options[n]=r)}),this}}}),define("gallery",["backbone","spinners","mixins/data-options","mousewheel"],function(e,t,n){var r=e.View.extend({queue:[],action:!1,timer:null,options:{photo:{box:".photo-box",item:".image"},preview:{box:".preview-box",viewport:".preview-viewport",item:".preview",viewCount:0,viewLimit:0,rowsCount:0,itemCount:0,height:0},slideshow:{time:0,status:"stop",timer:null},scroll:{action:!1,delta:0,h1:0,h2:0}},events:{mousewheel:"onMousewheel"},initialize:function(){this.parseOptions(),this.initSize()},initSize:function(){var e=this;this.options.slideshow.time=this.options.slideshowTime==undefined?0:parseInt(this.options.slideshowTime),this.options.slideshow.status=this.options.slideshow.time>0?"start":"stop",e.options.previewEnable==1?(this.$el.find(this.options.photo.box).width(this.options.photoWidth+"%"),this.$el.find(this.options.preview.box).width(100-this.options.photoWidth+"%"),this.options.previewPosition=="right"?this.$el.find(this.options.preview.viewport).css("paddingLeft",this.options.previewMargin):this.$el.find(this.options.preview.viewport).css("paddingRight",this.options.previewMargin),this.$el.find(this.options.preview.item).css({marginRight:this.options.previewMargin,marginBottom:this.options.previewMargin}),this.$el.find(this.options.preview.item+":nth-child("+this.options.previewCols+"n)").css({marginRight:0})):this.$el.find(this.options.photo.box).width("100%"),$(window).on("resize.gallery",function(){e.options.previewEnable==1?e.resizeSize():$(e.el).height(parseInt(e.$el.find(e.options.photo.box).width()/1.5)),e.$el.find(e.options.photo.item+" img").each(function(){e.setImageSize(this,1.5,e.options.imagePosition)})}).trigger("resize.gallery"),this.createQueue(),t.create(this.$el.find(this.options.photo.item+" .spinner"),{radius:7,height:10,width:1.5,dashes:20,opacity:.85,rotation:800,color:"#000000"}).center().play(),e.options.previewEnable==1&&$(this.options.preview.item).click(function(){$(this).is(".loading")==0&&(window.clearInterval(e.options.slideshow.timer),e.options.slideshow.status="stop",e.showImage($(this).index()))}),$(this.options.photo.item).click(function(){$(this).is(".loading")==0&&(window.clearInterval(e.options.slideshow.timer),e.options.slideshow.status="stop",e.showImage($(this).index()+1))})},resizeSize:function(){this.$el.find(this.options.preview.viewport).css({width:this.$el.find(this.options.preview.box).width()}),$(this.el).height(parseInt(this.$el.find(this.options.photo.box).width()/1.5));var e=this.options.preview.height=Math.floor((this.$el.find(this.options.preview.viewport).width()-(this.options.previewCols-1)*this.options.previewMargin)/this.options.previewCols);this.$el.find(this.options.preview.item).css({width:e,height:e}),this.options.scroll.delta=e+this.options.previewMargin,this.options.scroll.h1=this.$el.find(this.options.preview.box).height(),this.options.scroll.h2=this.$el.find(this.options.preview.viewport).height(),this.options.preview.viewCount=Math.ceil(this.$el.find(this.options.preview.box).height()/(e+this.options.previewMargin)),this.options.preview.viewLimit=parseInt(this.options.preview.viewCount/2),this.options.preview.viewLimit=this.options.preview.viewLimit+this.options.preview.viewCount%2,this.options.preview.itemCount=this.$el.find(this.options.preview.item).size(),this.options.preview.rowsCount=Math.ceil(this.$el.find(this.options.preview.item).size()/this.options.previewCols)},createQueue:function(){var e=this,t=[],n=[],r=0;this.$el.find(this.options.photo.item).each(function(){t.push(this)}),e.options.previewEnable==1&&this.$el.find(this.options.preview.item).each(function(){n.push(this)});for(i in t)this.queue.push(t[i]),r<=n.length&&(this.queue=_.union(this.queue,n.slice(r,r+this.options.queueRate)),r+=this.options.queueRate);t=n=undefined,this.$el.find(this.options.photo.item).on("load.gallery",function(){e.loadQueueItem()}),e.options.previewEnable==1&&this.$el.find(this.options.preview.item).on("load.gallery",function(){e.loadQueueItem()}),e.loadQueueItem()},loadQueueItem:function(){var e=this;if(e.queue.length>0){var t=e.queue.shift(),n=$(t).find("img"),r=$(t).find(".spinner");$(n).attr("src",$(n).attr("data-src")).on("load error",function(){r.remove(),$(n).data("type")=="photo"?e.setImageSize(this,1.5,e.options.imagePosition):e.setImageSize(this,1,"out"),$(t).removeClass("loading").addClass("loaded"),e.options.slideshow.status=="start"&&$(t).index()==0&&$(n).data("type")=="photo"&&e.startSlideshow(),e.options.slideshow.status=="wait"&&$(t).index()>0&&$(n).data("type")=="photo"&&(e.options.slideshow.status="start",e.showImage($(t).index())),$(t).trigger("load.gallery")})}},showImage:function(e){if(this.action==0){var t=this;t.action=!0;var n=t.$el.find(t.options.photo.item).eq(e),r=t.$el.find(t.options.photo.item+":visible");if(r.index()!=e&&n.size()==1){if(n.is(".loading")){var i=_.indexOf(t.queue,n[0]),s=t.queue.slice(0,i),o=t.queue.slice(i,i+1),u=t.queue.slice(i+1);t.queue=_.union(o,s,u),i=s=o=u=undefined}r.fadeOut(t.options.photoEffectTime,function(){if(t.options.previewEnable==1){t.$el.find(t.options.preview.item).eq(r.index()).removeClass("active"),t.$el.find(t.options.preview.item).eq(e).addClass("active");var i=Math.floor(e/t.options.previewCols)+1,s=0;i<=t.options.preview.viewLimit?s=0:i>t.options.preview.rowsCount-t.options.preview.viewLimit?s=t.options.preview.rowsCount-t.options.preview.viewCount:s=i-t.options.preview.viewLimit,s*=t.options.preview.height+t.options.previewMargin;if(i==t.options.preview.rowsCount){var o=$(t.options.preview.viewport).height(),u=(t.options.preview.rowsCount-t.options.preview.viewCount)*(t.options.preview.height+t.options.previewMargin)+$(t.options.preview.box).height();o>u&&(s+=o-u-t.options.previewMargin)}$(t.options.preview.viewport).animate({top:"-"+s+"px"},t.options.photoEffectTime)}n.fadeIn(t.options.photoEffectTime,function(){t.options.slideshow.status=="start"&&t.startSlideshow(),t.action=!1})})}else t.action=!1}},setImageSize:function(e,t,n){var r=t,i=$(e).parent().data("width")/$(e).parent().data("height");if(n=="in")var s=r>=i?"h":"w";else var s=r>=i?"w":"h";$(e).removeClass("w h").addClass(s);var o=$(e).parent().width(),u=$(e).parent().height(),a=$(e).parent().is(":visible");a==0&&$(e).parent().css({visible:"hidden",display:"block"});var f=$(e).width(),l=$(e).height();a==0&&$(e).parent().css({visible:"",display:"none"});var c=ml=0;f!=o&&(ml=parseInt((o-f)/2)),l!=u&&(c=parseInt((u-l)/2)),$(e).css({marginLeft:ml+"px",marginTop:c+"px"})},startSlideshow:function(){var e=this;e.options.slideshow.timer=setTimeout(function(){e.nextSlideshow()},e.options.slideshow.time)},nextSlideshow:function(){var e=this,t=e.$el.find(e.options.photo.item+":visible"),n=e.$el.find(e.options.photo.item).eq(t.index()+1);n.is(".loaded")?e.showImage(t.index()+1):e.options.slideshow.status="wait"},onMousewheel:function(e,t,n,r){var i=this;if(i.options.scroll.action==0&&i.action==0){i.options.scroll.action=!0;var s=Math.abs(parseInt(i.$el.find(this.options.preview.viewport).css("top")));r>0?(s+=i.options.scroll.delta,s>i.options.scroll.h2-i.options.scroll.h1&&(s=i.options.scroll.h2-i.options.scroll.h1)):(s-=i.options.scroll.delta,s<0&&(s=0)),i.$el.find(this.options.preview.viewport).animate({top:"-"+s+"px"},100,"linear",function(){i.options.scroll.action=!1})}},render:function(){return this}});return _.extend(r.prototype,n),r});